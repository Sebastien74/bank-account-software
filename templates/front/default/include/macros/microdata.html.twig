{% trans_default_domain 'front_default' %}

<!-- TO CHECK IF MACRO IS NOT EMPTY macro.name|trim is not empty -->

{% macro view(media = null, seo = null, type = 'Article') %}
    {% set displayMicrodata = true %}
    {% set displayMedia = media.extension is defined and media.extension not in ['.svg', '.gif', '.mp3'] %}
    {% if displayMedia %}
        {% set microdata_1x1 = media|file({}, {beforeRender: true, path: true, filter: 'microdata_1x1'}) %}
        {% set microdata_4x3 = media|file({}, {beforeRender: true, path: true, filter: 'microdata_4x3'}) %}
        {% set microdata_16x9 = media|file({}, {beforeRender: true, path: true, filter: 'microdata_16x9'}) %}
        {% if 'in-progress' == microdata_1x1 %}
            {% set displayMicrodata = false %}
        {% endif %}
    {% endif %}
    {% if displayMicrodata %}
        <!-- Microdata -->
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "{{ type }}",
                "name": "{{ seo.title|striptags|raw }}",
                "mainEntityOfPage": {
                    "@type": "WebPage",
                    "@id": "{{ seo.canonical }}"
                },
                "url": "{{ seo.canonical }}",
                "headline": "{{ seo.title|striptags|raw }}",
                {% if displayMedia %}
                "image": [
                    "{{ media|imgFilter('microdata_1x1', true) }}",
                    "{{ media|imgFilter('microdata_4x3', true) }}",
                    "{{ media|imgFilter('microdata_16x9', true) }}"
                ],
                {% endif %}
                "author": {
                    "@type": "{{ seo.microdata.authorType }}",
                    "name": "{{ seo.microdata.author|striptags|raw }}",
                    "url": "{{ seo.microdata.companyLogo }}"
                },
                {% if seo.publishedDate %}"datePublished": "{{ seo.publishedDate|date('Y-m-d H:i:s P') }}",{% endif %}
                {% if seo.updatedAt %}"dateModified": "{{ seo.updatedAt|date('Y-m-d H:i:s P') }}",{% endif %}
                {% if seo.description %}"description": "{{ seo.description }}",{% endif %}
                {% if seo.keywords %}"keywords": "{{ seo.keywords }}",{% endif %}
                "publisher": {
                    "@type": "{{ seo.microdata.companyType }}",
                    "name": "{{ seo.microdata.companyName|striptags|raw }}",
                    "logo": {
                        "@type": "ImageObject",
                        "url": "{{ seo.microdata.companyLogo }}"
                    }
                }
            }
        </script>
    {% endif %}
{% endmacro %}